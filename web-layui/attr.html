<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <script type="text/javascript" src="include/admin/title.js"></script>
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <script type="text/javascript" src="include/admin/side.js"></script>
    <script type="text/javascript" src="include/admin/header.js"></script>
    <script type="text/javascript" src="include/admin/footer.js"></script>

    <div class="layui-body">
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px">
            <legend>上传属性</legend>
        </fieldset>
        <div style="width: 1000px; margin: 0 auto;">

            <form id="form" class="layui-form layui-form-pane" autocomplete="off">
                <div class="layui-form-item">
                    <label class="layui-form-label">选择分类</label>
                    <div class="layui-input-block">
                        <div id="category"></div>
                    </div>
                </div>

                <div id="sku"></div>

                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">JSON</label>
                    <div class="layui-input-block">
                        <textarea id="content" class="layui-textarea"></textarea>
                    </div>
                </div>

                <div class="layui-form-item">
                    <a class="layui-btn layui-btn-fluid" id="test">测试</a>
                </div>
            </form>
        </div>
    </div>
</div>
<script type="text/html" id="barTpl">
    <a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="add">添加</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delete">删除</a>
</script>
<script>
    layui.config({
        base: 'layui/lay/extend/'
    }).extend({
        xmSelect: 'xm-select', // https://gitee.com/maplemei/xm-select
        sku: 'sku' // https://github.com/yinxu46/sku
    }).use(['jquery', 'element', 'xmSelect', 'sku'], function () {
        var $ = layui.jquery, xmSelect = layui.xmSelect, sku = layui.sku;

        var SKU = sku.init({id: '', item: '', data: []});

        $('#test').click(function () {
            $('#content').val(JSON.stringify(SKU.getData()) + '\n' + JSON.stringify(SKU.getItem()));
        });

        var categoryId;
        $.get('category/list', function (res) {
            xmSelect.render({
                el: '#category',
                tips: '请选择分类',
                name: 'category',
                layVerify: 'required',
                model: {icon: 'hidden', label: {type: 'text'}},
                radio: true,
                clickClose: true,
                tree: {
                    show: true,
                    strict: false,
                    expandedKeys: true,
                },
                data: res.data,
                prop: {value: 'id'},
                on: function (data) {
                    categoryId = data.change[0].id;
                    $.get('sku/' + categoryId, function (res) {
                        $('#sku').html(''); // 清空
                        $('#content').html(''); // 清空
                        SKU = sku.init({id: 'sku', item: res.data, data: []});

                        $('i[name="addName"]').click(function () {
                            layer.prompt({
                                formType: 0, // 0（文本）默认1（密码）2（多行文本）
                                value: 'name',
                                title: '请输入属性名',
                                area: ['800px', '400px']
                            }, function (value, index, elem) {
                                layer.msg(categoryId + ' ' + value);
                            });
                        });

                        $('i[name="addValue"]').click(function (e) {
                            layer.prompt({
                                formType: 0, // 0（文本）默认1（密码）2（多行文本）
                                value: 'value',
                                title: '请输入属性值',
                                area: ['800px', '400px']
                            }, function (value, index, elem) {
                                var attributeId = $(e.currentTarget).data('id');
                                layer.msg(attributeId + ' ' + value);
                            });
                        });

                        $('i[name="deleteName"]').click(function (e) {
                            layer.confirm('确认删除？', function (index) {
                                var attributeId = $(e.currentTarget).data('id');
                                layer.msg(attributeId);
                            });
                        });

                        $('i[name="deleteValue"]').click(function (e) {
                            layer.confirm('确认删除？', function (index) {
                                var attributeId = $(e.currentTarget).data('id');
                                layer.msg(attributeId);
                                // $.delete('seller/product/' + obj.data.id, function (res) {
                                //     if (res.code === 0) {
                                //         obj.del();
                                //     }
                                // });
                            });
                        });
                    });
                },
            });
        });
    });
</script>
</body>
</html>
