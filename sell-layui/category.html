<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <script type="text/javascript" src="include/title.js"></script>
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <script type="text/javascript" src="include/header.js"></script>
    <script type="text/javascript" src="include/side.js"></script>
    <script type="text/javascript" src="include/footer.js"></script>

    <div class="layui-body">
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
            <legend>分类管理</legend>
        </fieldset>
        <div style="width: 500px; margin: 0 auto;">
            <div id="tree"></div>
        </div>
    </div>
</div>
<script>
    layui.use(['jquery', 'element', 'tree'], function () {
        var $ = layui.jquery;
        var tree = layui.tree;

        $.get('category/list', function (res) {
            tree.render({
                elem: '#tree',
                // data: [{value: 0, title: '所有商品', children: res.data, spread: true}], // 构造根节点
                data: res.data,
                id: 'demo', // reload
                edit: ['add', 'update', 'del'],
                showLine: true,
                operate: function (obj) {
                    switch (obj.type) {
                        case 'add':
                            console.log(obj.data);
                            $.post('category', {title: '未命名', pid: obj.data.id}, function (res) {
                                if (res.code === 0) {
                                    layer.msg(res.msg);
                                }
                                setTimeout(function () {
                                    window.location.reload();
                                }, 1000); // 有点粗暴
                            });
                            break;
                        case 'update':
                            $.put('category/' + obj.data.id, {title: obj.data.title}, function (res) {
                                if (res.code === 0) {
                                    layer.msg(res.msg);
                                }
                                setTimeout(function () {
                                    window.location.reload();
                                }, 1000); // 有点粗暴
                            });
                            break;
                        case 'del':
                            if (obj.data.children.length !== 0) {
                                layer.alert("请先删除子分类后再进行操作！");
                                tree.update('demo', {});
                            } else {
                                $.delete('category/' + obj.data.id, function (res) {
                                    if (res.code === 0) {
                                        layer.msg(res.msg);
                                    } else {
                                        setTimeout(function () {
                                            window.location.reload();
                                        }, 1000); // 有点粗暴
                                    }
                                });
                            }
                            break;
                    }
                }
            });
        });
    });
</script>
</body>
</html>
